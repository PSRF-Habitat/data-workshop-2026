---
title: "PSRF Data Workshop 2026"
author: "Marina Kochuten"
format: html
editor_options: 
  chunk_output_type: console
---

# Intro to Quarto & Markdown

::: callout-tip
Quarto was Posit's follow up to R markdown files.

Quarto documents are fully reproducible and support dozens of output formats, like PDFs, Word files, presentations, and more (my website is built with Quarto!).

Quarto files are designed to be used in three ways:

For communicating to decision-makers, who want to focus on the conclusions, not the code behind the analysis.

For collaborating with other data scientists (including future you!), who are interested in both your conclusions, and how you reached them (i.e. the code).

As an environment in which to do data science, as a modern-day lab notebook where you can capture not only what you did, but also what you were thinking.
:::

## Writing Markdown Text

# This is a level one header

## This is a level two header

### This is a level three header

#### And so on

**This text is bold**

*This text is italic*

And this:

-   is
-   a
-   list

Here, I can link a [super cool website](https://restorationfund.org)

**To write code** 

Create a code chunk with the keyboard shortcut `Ctrl+Alt+I` (or `Cmd+Option+I` on Mac)

To run it, use `Ctrl+Shift+Enter` (Mac users: `Cmd+Shift+Enter`)

```{r}
2 + 2
```

If we were to render this into a document, you would see the code as well as the output. We can change this by using code-chunk options:

```{r}
#| code-fold: true

# This code will only show if you click on a dropdown to open it
2 + 2
```

```{r}
#| echo: false

# This code will not show at all, only the output
2 + 2
```

```{r}
#| include: false

# This code will run, but the code nor the output will show up in the rendered document
2 + 2
```


::: callout-tip
This is just a very brief intro to using Markdown in Quarto.

To learn more about Markdown, inserting tables and figures, and more see this [Comprehensive Guide to Using Quarto](https://quarto.org/docs/guide/)
:::


# Penguiuns Analysis

## About

This script hosts the code to clean and visualize data about the Palmer Penguins for the purpose of teaching some data wrangling best practices to the amazing PSRF team! 

**About the data**

There are 2 data files used in this analysis:

- `messy_penguins.csv`: contains size measurements for three penguin species observed on three islands in the Palmer Archipelago, Antarctica
- `nesting.csv`: contains nesting site counts for each species, on each island

`messy_penguins.csv` is derived from the Palmer Penguins data set from the Environmental Data Initiative (EDI) Data Portal. These data were collected from 2007 - 2009 by Dr. Kristen Gorman with the Palmer Station Long Term Ecological Research Program, part of the US Long Term Ecological Research Network. This data set was purposefully "messied" in order to practice some important data wrangling techniques.

`nesting.csv` is entirely constructed from my imagination for teaching purposes!

## Setup

```{r}
# Load libraries ----
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(gghighlight)
library(sysfonts)
library(showtext)

# Read in data ----
penguins_raw <- read_csv(here("data", "raw", "messy_penguins.csv"))
nesting_raw <- read_csv(here("data", "raw", "nesting.csv")) 
```


## Data exploration

Always take some time to get to know the data. Understanding the underlying structure of your data ahead of time makes cleaning and analysis much easier later!

### Penguins data

```{r}
# What columns are in the penguins data?
colnames(penguins_raw)

# How many penguins species are in the data?
n_distinct(penguins_raw$Species)

# What are they?
unique(penguins_raw$Species)

# What islands?
unique(penguins_raw$island)
# Looks like we will need to clean up this column later
```

### Nesting

```{r}
# What columns are in the Island info data?
colnames(nesting_raw)
```

## Data Cleaning

### Penguins

```{r}
# Peek at the data
head(penguins_raw)
```


```{r}
# Clean up column names for consistency
penguins_clean <- penguins_raw |>
  clean_names()

# Check column name fix
colnames(penguins_clean)
```


```{r}
# Species column ----
unique(penguins_clean$species) # looks good!
```


```{r}
# Island column ----
# Fix inconsistent capitalization in island column
penguins_clean <- penguins_clean |>
  mutate(island = str_to_title(island))

# Check island column capitalization fix
unique(penguins_clean$island)
```

```{r}
# Bill length column ----
range(penguins_clean$bill_length_mm, na.rm = TRUE)  # hmm... that's not right. 

# Not only is -999 not a valid bill length, but I would expect this column to be strictly numeric
class(penguins_clean$bill_length_mm) # Character, when would expect numeric

# What values are not recognized as a numeric?
penguins_clean |>
  count(bill_length_mm) |>
  filter(is.na(as.numeric(bill_length_mm)))

# It is common to have multiple funky ways to encode NAs. Let's change that now
penguins_clean <- penguins_clean |>
  mutate(bill_length_mm = as.numeric(bill_length_mm)) 
# Using as.numeric will make anything that R doesn't know how to make a number NA
```

I want to note that this is one way to carefully handle encoding NAs. I will also frequently do this when I read in the data, especially if I already know how NAs are handled. You can do this using the `na =` argument in `read_csv()`.

```{r}
# Now we can make sure the range of values for bill length makes sense
range(penguins_clean$bill_length_mm, na.rm = TRUE)

# Still need to handle -999
penguins_clean <- penguins_clean |>
  mutate(bill_length_mm = case_when(bill_length_mm == -999.0 ~ NA,
                                    .default = bill_length_mm))

# Check
range(penguins_clean$bill_length_mm, na.rm = TRUE) # much better
```

In this case, I am going to skip over the next few columns and get to `observation_date`. I highly recommend taking the time to check through each column and look for anything unexpected at this stage in the data process! 

```{r}
# Observation date column ----
head(penguins_clean$observation_date) # yikes, what a mess

# Fix datetime column
penguins_clean <- penguins_clean |>
  mutate(date = parse_date_time(observation_date,
                                orders = c("dmy", "ymd", "mdy", "ymd HMS")))

head(penguins_clean$date)

# Do not need to keep the time
penguins_clean <- penguins_clean |>
  separate(col = date,
           into = c("date", "time"),
           sep = " ") |>
  # Need to re-convert to date after using separate()
  mutate(date = as.Date(date))

# Drop date columns we don't need
penguins_clean <- penguins_clean |>
  select(-c(time, observation_date))

# Create some new variables based on date
penguins_clean <- penguins_clean |>
  mutate(year = year(date),
         month = month(date, label = TRUE, abbr = FALSE),
         day = day(date),
         day_of_year = yday(date))

# Check out changes
head(penguins_clean)
```

Other good ideas when cleaning data is to check for duplicates

```{r}
# Check for duplicate rows
penguins_clean |>
  get_dupes()
```

Deciding how to handle duplicates can be tricky. Is it possible that two penguins measured on the same day have the exact same measurements? Perhaps! It is possible that there was an error made during data entry? Also likely! Things I like to think about before removing duplicates:

- Check field notes or datasheet scans
- Check with field team / whoever entered the data when possible
- Only a few duplicate observations in a large data set? Won't change much to remove
- Lot's of duplicates, removing would take out more than 5% - 10% of the data? Reconsider

Whatever you decide, the most important thing is that you document what you are doing and why. The beauty about making these changes 1. not in the raw data and 2. with code is that it is very easy to go back if you change your mind.

For this case, let's assume it was a data entry error and remove the duplicate rows from the dataset entirely.

```{r}
# Remove duplicates in penguins data ----
# Count rows before removing
nrow(penguins_clean)

# Remove duplicates
penguins_clean <- penguins_clean |>
  distinct()

# Count rows after removing
nrow(penguins_clean)
```


```{r}
# Save cleaned penguin data ----
write_csv(penguins_clean, here("data", "processed", "penguins.csv"))
```

Now that we have completed this chuck of data cleaning, let's push to GitHub. 

## Some exploratory viz




## Nesting Sites

Let's say we are interesting in comparing the number of female penguins counted and the number of nesting sites each year. Since these data live in different datasets we need to join them! 

First, we need to get our nesting data in tidy format:

```{r}
# Pivot nesting data from wide to long
nesting_clean <- nesting_raw |>
  pivot_longer(cols = starts_with("nesting"),
               names_to = "year",
               names_prefix = "nesting_sites_",
               values_to = "nesting_sites")
```

And, to make things easier later let's count female penguins now:

```{r}
# Count the number of female penguins for each species, island, and year
penguins_fem_count <- penguins_clean |>
  group_by(species, island, sex, year) |>
  summarise(count = n()) |>
  filter(sex == "female")
```


Next, we need to choose which join to use. There are many kinds, here are a few:

- **Full join**: Keep all observations from both datasets
- **Left join**: Keep all observations in dataset y that have matches in x
- **Anti join**: Keep only observations in x that have no matches in y

When you join two datasets, they need a shared key to join on.

In our case, we want to use a left join, joining the nesting data to the penguins on species, island, and year.

```{r}
# Join penguins and nesting data
pen_nest <- left_join(penguins_fem_count, nesting_clean,
                      by = c("species", "island", "year"))

# Error - need to make year in nesting_clean numeric
nesting_clean <- nesting_clean |>
  mutate(year = as.numeric(year))

# Now try joining penguins and nesting data
pen_nest <- left_join(penguins_fem_count, nesting_clean,
                      by = c("species", "island", "year"))
```

Now we can visualize the relationship!

```{r}
# Exploratory viz - female penguin count vs number of nesting sites
ggplot(pen_nest) +
  geom_point(aes(x = nesting_sites, y = count, color = species)) +
  labs(title = "Penguins counted vs number of nesting sites")
```


# Visualization

Let's build some viz together! In general, data viz has very few rules and a handful of suggestions. We won't have time to go over all of these today, but I can show you a few steps I take with almost all viz to make them look really nice and follow good practices.

## Labels and Aesthetics

```{r}
# Penguin counts bar chart
#counts_bar <- 
penguins_clean |>
  mutate(species = fct_rev(fct_infreq(species))) |>
  ggplot() +
  geom_bar(aes(x = species)) +
  geom_text(aes(x = species, label = after_stat(count)),
            stat = "count",
            hjust = 1.5,
            color = "white",
            size = 5) +
 # scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  labs(title = "Penguins counts at Palmer Station LTER",
       subtitle = "2007 - 2009",
       caption = "Data: Gorman et al. 2014 via {palmerpenguins}") +
  coord_flip() +
  theme_minimal(base_size = 14) +
  theme(
    axis.title = element_blank(),
    legend.position = "none",
    panel.grid = element_blank(),
    plot.title.position = "plot",
    axis.text.x = element_blank(),
    plot.margin = margin(20,20,20,20),
    plot.caption = element_text(face = "italic",
                                color = "grey50"))

  # theme(
 #    axis.title = element_text(size = rel(1.2)), # 1.2 * base_size
 #    axis.text = element_text(size = rel(0.8))   # 0.8 * base_size
 #  )

ggsave(here("figs", "counts_bar.png"), width = 6)
```

## Color & Highlighting

Let's start with a base plot showing the distribution of penguin body masses: 

```{r}
# Penguin body mass histogram
ggplot(data = penguins_clean, aes(x = body_mass_g)) +
  geom_histogram() +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass") +
  theme_minimal()
```

Let's color by species to see how the size distributions compare

```{r}
# Color histogram by species & update legend title
ggplot(data = penguins_clean, aes(x = body_mass_g, fill = species)) +
  geom_histogram(
    #alpha = 0.5,
                 # Unlike the default `position = "stack"`, "identity" places
                 # bars from different groups at the same x positions 
                 # and starting from 0 on the y axis, 
                 # allowing them to overlap. Always use when comparing 
                 # multiple groups in one histogram
                 position = "identity") +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass",
       fill = "Species") +
  theme_minimal()
```

Always a good idea to change from the ggplot default colors

```{r}
# Change colors & transparency
ggplot(data = penguins_clean, aes(x = body_mass_g, fill = species)) +
  geom_histogram(position = "identity",
                 alpha = 0.5) +
  scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass",
       fill = "Species") +
  theme_minimal()
```


There are many ways to use highlighting to help make comparisons and draw out important messages. 

One way we can highlight specific groups:

```{r}
# Can also use gghighlight to easily highlight one group that you might want to showcase
# gghighlight can be buggy, but also can be really great for drawing attention to certain lines, points, groups, etc
ggplot(data = penguins_clean, aes(x = body_mass_g, fill = species)) +
  geom_histogram(position = "identity",
                 alpha = 0.5) +
  scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  gghighlight(species == "Chinstrap", label_key = type) +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass",
       fill = "Species") +
  theme_minimal()
```

Alternatively, we can use `gghighlight` paired with facet to keep the other groups distributions across facets for easy comparison

```{r}
ggplot(data = penguins_clean, aes(x = body_mass_g, fill = species)) +
  geom_histogram(alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  gghighlight() +
  facet_wrap(~species) +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass") +
  theme_minimal()
```

Now that we have a solid graphic form and messaging, I always add these last few touches to improve aesthetics and readability

```{r}
pen_hist <- ggplot(data = penguins_clean, aes(x = body_mass_g, fill = species)) +
  geom_histogram(alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  gghighlight() +
  facet_wrap(~species) +
  labs(x = "Body mass (g)",
       y = "Frequency",
       title = "Penguin body mass") +
  # Add a comma to the labels
  scale_x_continuous(labels = scales::label_comma()) +
  # Remove space between 0 and x axis
  scale_y_continuous(expand = expansion(add = c(0, 0.5))) +
  theme_minimal(base_size = 14) +
  theme(
    # Fix x axis text overlap by putting more space between the facet panels
    panel.spacing.x = unit(1.25, "cm"),
    # Increase facet title text and make bold
    strip.text = element_text(size = rel(1), face = "bold"),
    # Add border around facet panels to help me distinguish across x axis
    panel.border = element_rect(),
    # I always like to give things a little more breathing room by adding margins
    axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
    axis.title.y = element_text(margin = margin(0, 15, 0, 0)),
    plot.title = element_text(margin = margin(0, 0, 15, 0), face = "bold"),
    plot.margin = margin(20, 20, 20, 20)
  )

# Now that I am pleased with this plot, I can save:
ggsave(here("figs", "pen_hist.png"), pen_hist, width = 8, height = 4.5)
```


## Trendlines

It can be helpful to visualize relationships in data by adding a trend line! This can really highlight relationships to your reader, but should really be careful to be added to your data responsibly. Let's use a scatterplot of bill depth vs bill length as an example:

```{r}
# Simple plot of bill length vs width
ggplot(data = penguins_clean) +
  geom_point(aes(x = bill_length_mm,
                 y = bill_depth_mm)) 

# Let's see what it looks like if we fit a linear model to this data using geom_smooth
ggplot(data = penguins_clean) +
  geom_point(aes(x = bill_length_mm,
                 y = bill_depth_mm)) +
  geom_smooth(aes(x = bill_length_mm,
                 y = bill_depth_mm),
              method = "lm", se = FALSE)
```

In this plot, we would gather that penguin bill depth and penguin bill length are negatively related to one another.

But wait... what happens if we include our species groups?

```{r}
# Color points by species
ggplot(data = penguins_clean) +
  geom_point(aes(x = bill_length_mm,
                 y = bill_depth_mm,
                 color = species)) +
  geom_smooth(aes(x = bill_length_mm,
                 y = bill_depth_mm),
              method = "lm", se = FALSE)
```

Thinking that our trend line might not be acting as expected ... 

```{r}
# Seperate lines for each group
ggplot(data = penguins_clean) +
  geom_point(aes(x = bill_length_mm,
                 y = bill_depth_mm,
                 color = species)) +
  geom_smooth(aes(x = bill_length_mm,
                 y = bill_depth_mm,
                 color = species),
              method = "lm", se = FALSE)
```

This is an example of Simpson's Paradox, a common stats phenomenon where a relationship between variables observed when groups are combined reverses when the groups are observed separately. 

It is important when you are creating analyses that you have a solid understanding about your data structure and study system!

Let's make this one pretty :) 

## Legends

Legends are a tricky one. On one hand, they are often necessary to guide the reader through your plot (or, in the case of a scientific journal, often expected in a certain format). Other times, they are redundant and just adding noise. Here are a handful of creative ways to replace a legend in your viz:

1. When you can, I almost always recommend moving the legend inside of your plot, as we did briefly in the previous example

Here is a new example plot to demonstrate: 
```{r}
# Scatterplot of bill length vs depth
ggplot(data = penguins_clean,
       aes(x = bill_length_mm,
           y = bill_depth_mm,
           group = species)) +
  geom_point(aes(color = species, 
                 shape = species),
             size = 3,
             alpha = 0.8) +
  geom_smooth(method = "lm", se = FALSE, aes(color = species)) +
  scale_color_manual(values = c("darkorange","purple","cyan4")) +
  labs(title = "Penguin bill dimensions",
       subtitle = "Bill length and depth for Adelie, Chinstrap and Gentoo Penguins at Palmer Station LTER",
       x = "Bill length (mm)",
       y = "Bill depth (mm)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal(base_size = 14) +
  theme(legend.position = c(0.85, 0.15),
        plot.title.position = "plot",
        plot.margin = margin(10,10,10,10),
        axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
        axis.title.y = element_text(margin = margin(0, 15, 0, 0)),
        plot.subtitle = element_text(margin = margin(0,0,15,0)),
        plot.title = element_text(face = "bold"))


# 2. incorporate legend into the title
ggplot(data = penguins_clean,
       aes(x = bill_length_mm,
           y = bill_depth_mm,
           group = species)) +
  geom_point(aes(color = species, 
                 shape = species),
             size = 3,
             alpha = 0.8) +
  geom_smooth(method = "lm", se = FALSE, aes(color = species)) +
  scale_color_manual(values = c("darkorange","purple","cyan4")) +
  labs(title = "Penguin bill dimensions",
       
       # Subtitle with HTML tags
       subtitle = "Bill length and depth for
       <span style='color:darkorange;'>**Adelie**</span>, 
       <span style = 'color:purple;'>**Chinstrap**</span>, 
       and <span style = 'color:cyan4;'>**Gentoo**</span>,
        penguins at Palmer Station LTER",
       
       x = "Bill length (mm)",
       y = "Bill depth (mm)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none",  # Remove the original legend
        plot.title.position = "plot",
        plot.subtitle = ggtext::element_markdown(), # To let R know you are styling the text
        plot.title = element_text(face = "bold"),
        plot.margin = margin(10,10,10,10),
        axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
        axis.title.y = element_text(margin = margin(0, 15, 0, 0)))


# 3. Label the lines directly
ggplot(penguins_clean, aes(x = bill_length_mm, y = bill_depth_mm, color = species, shape = species)) +
  geom_point(size = 3, alpha = 0.8) +
  geomtextpath::geom_labelsmooth(aes(label = species), method = "lm", size = 5) +
  scale_color_manual(values = c("darkorange","purple","cyan4")) +
  labs(title = "Penguin bill dimensions",
       subtitle = "Bill length and depth for Adelie, Chinstrap and Gentoo Penguins at Palmer Station LTER",
       x = "Bill length (mm)",
       y = "Bill depth (mm)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal(base_size = 20) +
  theme(legend.position = "none",  # Remove the original legend
        plot.title.position = "plot",
        plot.caption = element_text(hjust = 0, face= "italic"),
        plot.caption.position = "plot",
        plot.title = element_text(face = "bold"),
        plot.margin = margin(10,10,10,10),
        axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
        axis.title.y = element_text(margin = margin(0, 15, 0, 0)))
```

## Annotations

Annotations can be a good way to call out trends or observations. Let's start a new plot, this time a scatter plot of flipper length vs body mass:

```{r}
ggplot(penguins_clean, aes(x = flipper_length_mm, y = body_mass_g,
                           color = species, shape = species)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(title = "Penguin size, Palmer Station LTER",
       subtitle = "Flipper length and body mass for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Flipper length (mm)",
       y = "Body mass (g)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal()
```

Not bad! Let's increase our margins and play with our fonts:

```{r}
# Grab a google font to use in out plot
font_add_google(name = "Josefin Sans", family = "jo")

# Turn on the text renderer that will allow us to preview the Google font in the viewer
showtext_auto()

# Plot with new font
ggplot(penguins_clean, aes(x = flipper_length_mm, y = body_mass_g,
                           color = species, shape = species)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(title = "Penguin size, Palmer Station LTER",
       subtitle = "Flipper length and body mass for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Flipper length (mm)",
       y = "Body mass (g)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal(base_size = 14) +
  theme(
    # Make all text be Josefin Sans
    text = element_text(family = "jo"),
    # Give plot some breathing room
    axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
    axis.title.y = element_text(margin = margin(0, 15, 0, 0)),
    plot.title = element_text(margin = margin(0, 0, 10, 0), face = "bold"),
    plot.subtitle = element_text(margin = margin(0, 0, 15, 0)),
    plot.margin = margin(20, 20, 20, 20),
    # Move title all the way to the left
    plot.title.position = "plot"
  )
```

This is looking good! I will talk more on creative ways to handle legends a bit later. For now, to reduce eye movement and give the data more room, let's move this legend to inside the plot

```{r}
ggplot(penguins_clean, aes(x = flipper_length_mm, y = body_mass_g,
                           color = species, shape = species)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(title = "Penguin size, Palmer Station LTER",
       subtitle = "Flipper length and body mass for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Flipper length (mm)",
       y = "Body mass (g)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme_minimal(base_size = 14) +
  theme(
     legend.position = c(0.25, 0.75), # Move legend inside plot
  #  legend.position = "bottom", # Move legend to bottom of plot
    text = element_text(family = "jo"),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
    axis.title.y = element_text(margin = margin(0, 15, 0, 0)),
    plot.title = element_text(margin = margin(0, 0, 10, 0), face = "bold"),
    plot.subtitle = element_text(margin = margin(0, 0, 15, 0)),
    plot.margin = margin(20, 20, 20, 20),
    plot.title.position = "plot"
  )
```

We can use annotations to draw attention to certain pieces of the data.

```{r}
pen_size_annot <- ggplot(penguins_clean, aes(x = flipper_length_mm, y = body_mass_g,
                           color = species, shape = species)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  scale_y_continuous(labels = scales::label_comma()) +
  labs(title = "Penguin size, Palmer Station LTER",
       subtitle = "Flipper length and body mass for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Flipper length (mm)",
       y = "Body mass (g)",
       color = "Penguin species",
       shape = "Penguin species") +
  ggforce::geom_mark_ellipse(aes(filter = species == "Gentoo",
                                 label = "Gentoo penguins",
                                 description = "This species tends to have larger body masses and flipper lengths than the other species"),
                             color = "cyan4",
                             label.family = "jo",
                             label.fontsize = 14) +
  theme_minimal(base_size = 16) +
  theme(
    legend.position = "bottom", # We can also try the legend on the bottom
    legend.justification.bottom = 1,
    text = element_text(family = "jo"),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0)),
    axis.title.y = element_text(margin = margin(0, 15, 0, 0)),
    plot.title = element_text(face = "bold"),
    plot.subtitle = element_text(margin = margin(0, 0, 15, 0)),
    plot.margin = margin(20, 20, 20, 20),
    plot.title.position = "plot"
  )

ggsave(here("figs", "pen_size_annot.png"), pen_size_annot, 
       width = 14, height = 10)

# Woah. font size is being wonky. this is the one frustrating piece of showtext / playing with fonts. the showtext package renders the fonts at 96 DPI, which matches what the RStudio viewer shows us. However, we often want a higher resolution than that when we are exporting our plots. ggsave() default DPI is 300 (you can change this, but 300 DPI is standard for high quality images). 

# To get around this, we will tell showtext to give us fonts at 300 DPI
showtext_opts(dpi = 300) # Set the text scaling to match ggplot save

# We will want to run this, then run our plot code, and then save. You will notice that things in the RStuido viewer now look pretty bad, but if we open the saved image from our computer directly, things should look pretty good!

# Turn off the showtext renderer
showtext_end()
```
